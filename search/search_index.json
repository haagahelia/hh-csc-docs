{"config":{"lang":["fi"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"CSC-palvelut Haaga-Heliassa","text":"<p>T\u00e4lle sivustolle on koottu ohjeita CSC-palvelujen k\u00e4ytt\u00e4misest\u00e4 Haaga-Helia ammattikorkeakoulun opetuksessa.</p>"},{"location":"#kayttajatili","title":"K\u00e4ytt\u00e4j\u00e4tili","text":"<p>CSC-palvelujen k\u00e4ytt\u00f6\u00f6n tarvitaan CSC-k\u00e4ytt\u00e4j\u00e4tili. Tilin voi luoda kirjautumalla MyCSC-portaaliin osoitteessa https://my.csc.fi korkeakoulujen Haka-kirjautumispalvelun avulla. </p> <p>CSC-tunnuksen luominen tapahtuu ensimm\u00e4isen kirjautumisen yhteydess\u00e4. Jatkossa  MyCSC-portaaliin voi kirjautua joko suoraan Haka-tunnistuksella tai luodulla CSC-tunnuksella. </p> <p>Tunnusten luonnin ja kirjautumisen j\u00e4lkeen avautuu MyCSC-portaalin hallintan\u00e4kym\u00e4.</p> <p></p>"},{"location":"#projektit-ja-palvelut","title":"Projektit ja palvelut","text":"<p>MyCSC-portaalissa perustetaan projekteja. Web-k\u00e4ytt\u00f6isen hallintan\u00e4kym\u00e4n kautta MyCSC-projektiin voidaan liitt\u00e4\u00e4 k\u00e4ytt\u00e4ji\u00e4 ja palveluja.</p> <p>CSC-palvelua (esimerkiksi Rahti) konfiguroidessa puhutaan my\u00f6s projektista. MyCSC-projekti sis\u00e4lt\u00e4\u00e4 palveluja, jotka konfiguroidaan kunkin palvelun omassa projektissa. Muuta yhteist\u00e4 n\u00e4ill\u00e4 kahdella projektilla ei kuitenkaan ole.</p> <p>K\u00e4sitteiden selkiytt\u00e4miseksi n\u00e4iss\u00e4 ohjeissa eri projekteista k\u00e4ytet\u00e4\u00e4n termej\u00e4 MyCSC-projekti ja palveluprojekti (esim. Rahti-projekti. MyCSC-projekti on hallinnollinen projekti, johon voidaan liitt\u00e4\u00e4 joukko palveluprojekteja.</p>"},{"location":"#lisatietoa","title":"Lis\u00e4tietoa","text":"<p>CSC-palveluiden dokumentaatio l\u00f6ytyy osoitteesta https://docs.csc.fi/.</p>"},{"location":"opettajan_ohje/","title":"Opettajan ohje","text":""},{"location":"opettajan_ohje/#mycsc-projektit-kurssitoteutuksille","title":"MyCSC-projektit kurssitoteutuksille","text":"<p>Yhdelle kurssitoteutukselle perustetaan yksi MyCSC-projekti. </p> <p>Opettaja toimii projektin projektip\u00e4\u00e4llikk\u00f6n\u00e4 ja hallinnoi projektiin liitettyj\u00e4 palveluja sek\u00e4 projektin k\u00e4ytt\u00e4ji\u00e4.</p> <p>Projekteja hallinnoidaan MyCSC-portaalin kautta. Palvelu l\u00f6ytyy osoitteesta https://my.csc.fi. Palvelun k\u00e4ytt\u00e4minen vaatii oman CSC-tunnuksen, joka on otettavissa k\u00e4ytt\u00f6\u00f6n korkeakoulujen Haka-kirjautumispalvelun avulla (ks. luku K\u00e4ytt\u00e4j\u00e4tili). </p>"},{"location":"opettajan_ohje/#uuden-mycsc-projektin-perustaminen","title":"Uuden MyCSC-projektin perustaminen","text":"<p>Uuden projektin p\u00e4\u00e4see luomaan n\u00e4kym\u00e4n vasemman reunan valikosta Projects ja sen takaa l\u00f6ytyv\u00e4n sivun oikeasta yl\u00e4kulmasta painamalla nappia New project. Painike avaa uuden projektin luontin\u00e4kym\u00e4n.</p> <p></p> <p>Kurssiprojektista on hyv\u00e4 huomioida seuraavat seikat:</p> <ul> <li>Opetusk\u00e4yt\u00f6ss\u00e4 projektikategoriaksi tulee valita Course.</li> <li>Kurssin p\u00e4\u00e4ttymisp\u00e4iv\u00e4 voi olla korkeintaan kuuden kuukauden p\u00e4\u00e4ss\u00e4 luontip\u00e4iv\u00e4st\u00e4.</li> <li>Kurssiprojekti on kertak\u00e4ytt\u00f6inen. Sit\u00e4 ei voi jatkaa, kopioida eik\u00e4 siihen voi pyyt\u00e4\u00e4 lis\u00e4resursseja. Oletusresurssi projektille on 100 000 BU:ta.</li> <li>Projekti ja kaikki sen resurssit poistetaan automaattisesti loppumisajan j\u00e4lkeen.</li> <li>Kurssiprojekteja voi olla k\u00e4ynniss\u00e4 yht\u00e4 aikaa useita.</li> <li>Kurssiprojektien palveluihin ei saa tallentaa henkil\u00f6kohtaisia tietoja.</li> </ul> <p>BU eli Billing Unit on laskennallinen yksikk\u00f6, jolla seurataan resurssien k\u00e4ytt\u00f6\u00e4 projektissa. K\u00e4ytt\u00f6, yksik\u00f6n nimest\u00e4 huolimatta, on korkeakoulujen henkil\u00f6kunnalle ja opiskelijoille opetusk\u00e4yt\u00f6ss\u00e4 ilmaista. Lis\u00e4tietoa BU:sta l\u00f6ytyy osoitteesta https://docs.csc.fi/accounts/billing/. </p>"},{"location":"opettajan_ohje/#palvelujen-valinta","title":"Palvelujen valinta","text":"<p>Projektin kautta projektin j\u00e4senet p\u00e4\u00e4sev\u00e4t k\u00e4siksi CSC:n palveluihin. Oletuksena mit\u00e4\u00e4n palvelua ei ole liitetty projektiin, vaan projektip\u00e4\u00e4llikk\u00f6 valitsee haluamansa palvelut MyCSC sivuston kautta </p> <p></p> <p>Projektin palvelut valitaan palvelulistasta yksi kerrallaan.</p> <p> </p> <p>Projektiin lis\u00e4tyist\u00e4 palveluista l\u00e4hetet\u00e4\u00e4n kaikille projektin j\u00e4senille s\u00e4hk\u00f6posti, jossa pyydet\u00e4\u00e4n hyv\u00e4ksym\u00e4\u00e4n palvelun ehdot MyCSC-sivustolla.</p> <p>Kun halutut palvelut on valittu projektille ja k\u00e4ytt\u00e4j\u00e4t ovat hyv\u00e4ksyneet palvelun k\u00e4ytt\u00f6\u00f6noton, voidaan niiden k\u00e4ytt\u00f6 aloittaa.</p>"},{"location":"opettajan_ohje/#palvelujen-konfigurointi","title":"Palvelujen konfigurointi","text":"<p>Kun projektille on valittu halutut palvelut, niiden k\u00e4ytt\u00f6\u00f6notto ja konfigurointi tapahtuu kunkin palvelun omalta sivustolta. </p> <p>T\u00e4rkeimm\u00e4t palvelut ja niiden osoitteet on listattu taulukkoon</p> Palvelu Osoite Kuvaus MyCSC https://my.csc.fi Projektien hallintapalvelu Allas https://pouta.csc.fi Tallennuspalvelu cPouta https://pouta.csc.fi Virtualisointipalvelu Notebooks https://notebooks.csc.fi Jupyter Notebooks Puhti ja Mahti https://puhti.csc.fi https://mahti.csc.fi Laskentapalvelu Rahti https://rahti.csc.fi Konttipalvelu Pukki https://pukki.dbaas.csc.fi DBaaS (beta)"},{"location":"opettajan_ohje/#opiskelijoiden-lisaaminen-projektiin","title":"Opiskelijoiden lis\u00e4\u00e4minen projektiin","text":"<p>Jos opiskelijat tarvitsevat suoran p\u00e4\u00e4syn palveluihin (esim. Rahti), heid\u00e4n tulee liitty\u00e4 MyCSC-projektin j\u00e4seneksi.</p> <p>Projektip\u00e4\u00e4llikk\u00f6 (opettaja) lis\u00e4\u00e4 opiskelijat osaksi projektia, joko etsim\u00e4ll\u00e4 heid\u00e4t projektihallinnan Members-n\u00e4kym\u00e4ss\u00e4 CSC-tunnuksella tai l\u00e4hett\u00e4m\u00e4ll\u00e4 opiskelijoille kutsulinkin.</p> <p>Kutsulinkin voi generoida painamalla Invite painiketta ja l\u00e4hett\u00e4m\u00e4ll\u00e4 linkin opiskelijoille esimerkiksi s\u00e4hk\u00f6postilla tai lis\u00e4\u00e4m\u00e4ll\u00e4 sen Moodle-kurssin ty\u00f6tilaan. Linkill\u00e4 kutsutut opiskelijat hyv\u00e4ksyt\u00e4\u00e4n projektij\u00e4seneksi Members-n\u00e4kym\u00e4n Waiting approval valinnasta.</p> <p></p> <p>Kun opettaja on hyv\u00e4ksynyt opiskelijat projektin j\u00e4seneksi, tulee opiskelijoiden viel\u00e4 hyv\u00e4ksy\u00e4 MyCSC sivuston kautta projektiin valittujen palvelujen k\u00e4ytt\u00f6ehdot.</p> <p>Jos opiskelijat k\u00e4ytt\u00e4v\u00e4t pelk\u00e4st\u00e4\u00e4n CSC ymp\u00e4rist\u00f6\u00f6n pystytettyj\u00e4 palveluja (esim. www-sivustot, SQL-palvelin, tms.), joissa on toteutettu oma k\u00e4ytt\u00e4j\u00e4nhallinta, opiskelijan liitt\u00e4minen CSC-projektiin ei ole v\u00e4ltt\u00e4m\u00e4t\u00f6nt\u00e4. Esimerkkin\u00e4 t\u00e4mm\u00f6isest\u00e4 voisi olla opettajan pystytt\u00e4m\u00e4 Wordpress-sivusto ja johon opiskelijat kirjautuvat Wordpressiin tehdyill\u00e4 k\u00e4ytt\u00e4j\u00e4tunnuksilla.</p>"},{"location":"opiskelijan_ohje/","title":"Opiskelijan ohje","text":""},{"location":"opiskelijan_ohje/#kurssiprojektiin-liittyminen","title":"Kurssiprojektiin liittyminen","text":"<p>Avaa saamasi liittymislinkki ja kirjaudu MyCSC-palveluun Haka-tunnistuksella.</p> <p>Huom!</p> <p>Jos et ole ennen k\u00e4ytt\u00e4nyt CSC-palveluja, sinut ohjataan k\u00e4ytt\u00e4j\u00e4tilin luontiin.</p> <p>Paina projektin liittymissivulla Apply for membership. Saat vahvistuksen liittymispyynn\u00f6n l\u00e4hetyksest\u00e4.</p> <p>Huom!</p> <p>Projektip\u00e4\u00e4llik\u00f6n (opettajan) on hyv\u00e4ksytt\u00e4v\u00e4 liittymispyynt\u00f6si, jotta saat p\u00e4\u00e4syn projektiin.</p> <p>Kun pyynt\u00f6 on hyv\u00e4ksytty, saat yhden tai useampia s\u00e4hk\u00f6posteja:</p> <ul> <li>Saat vahvistuksen CSC-projektin liittymispyynt\u00f6si hyv\u00e4ksymisest\u00e4.</li> <li>Saat my\u00f6s viestin k\u00e4ytt\u00f6ehtojen hyv\u00e4ksymisest\u00e4 jokaisesta CSC-projektiin liitetyst\u00e4 palvelusta (esim. Rahti). Sinun on hyv\u00e4ksytt\u00e4v\u00e4 ehdot, jotta voit k\u00e4ytt\u00e4\u00e4 palveluja.</li> </ul>"},{"location":"opiskelijan_ohje/#opiskelijaprojekti","title":"Opiskelijaprojekti","text":"<p>Opintojaksoilla k\u00e4ytet\u00e4\u00e4n kurssiprojekteja, joita opettaja hallinnoi.</p> <p>Voit perustaa my\u00f6s oman CSC-projektin, jota hallinnoit itse. Ohjeet siihen l\u00f6ytyv\u00e4t CSC:n sivuilta Getting started with CSC services for students.</p>"},{"location":"rahti/buildin_automatisointi/","title":"Buildin automatisointi","text":"<p>Jos sovellukselle on build config, jolla julkaisu tehd\u00e4\u00e4n GitHub-repositoriosta, voidaan build konfiguroida k\u00e4ynnistym\u00e4\u00e4n automaattisesti, kun repositorioon pusketaan uutta koodia.</p> <p>Uusi build liipaistaan m\u00e4\u00e4ritt\u00e4m\u00e4ll\u00e4 GitHub-repositorioon webhook, jota repositorio kutsuu aina, kun uusia muutoksia pusketaan.</p> <p>Webhook-URL l\u00f6ytyy Rahti-palvelun k\u00e4ytt\u00f6liittym\u00e4ss\u00e4 kohdata Builds.</p> <p></p> <p>Kopioi URL ja lis\u00e4\u00e4 se Github-repositorioon GitHubin web-k\u00e4ytt\u00f6liittym\u00e4n kohdassa Settings/Webhooks/Add webhook.</p> <p></p> <p>Content type-asetuksen tulee olla <code>application/json</code>.</p>"},{"location":"rahti/https_konfigurointi/","title":"HTTPS-konfigurointi","text":"<p>Julkaistu palvelu tarjotaan oletusarvoisesti vain HTTP-protokollalla. Palvelu voidaan konfiguroida tarjottavaksi my\u00f6s HTTPS-protokollalla tai pelk\u00e4st\u00e4\u00e4n HTTPS-protokollalla.</p> Komentorivill\u00e4Web-k\u00e4ytt\u00f6liittym\u00e4ss\u00e4 <p>Konfiguroinnin voi tehd\u00e4 komentorivill\u00e4 komennolla  <pre><code>oc create route edge --service=&lt;service-name&gt;\n</code></pre></p> <p>Jos olet jo luonut suojaamattoman reitin eik\u00e4 komento siksi onnistu, voit poistaa vanhan reitin komennolla  <pre><code>oc delete route &lt;route-name&gt;\n</code></pre></p> <ul> <li><code>&lt;route-name&gt;</code> on reitin nimi. Reitin nimi on oletusarvoisesti sama kuin palvelun nimi. Voit listata olemassaolevat reitit komennolla <code>oc get route</code>.</li> </ul> <p>Web-k\u00e4ytt\u00f6liittym\u00e4ss\u00e4 m\u00e4\u00e4ritys tehd\u00e4\u00e4n Rahti-sovelluksen Route-m\u00e4\u00e4rittelyss\u00e4.</p> <p></p> <p></p> <p>Reitille voidaan konfiguroida TLS k\u00e4ytt\u00f6\u00f6n. Jos sertifikaatin j\u00e4tt\u00e4\u00e4 m\u00e4\u00e4ritt\u00e4m\u00e4tt\u00e4, k\u00e4ytet\u00e4\u00e4n oletussertifikaattia. HTTP-liikenteen voi joko sallia, est\u00e4\u00e4 tai uudelleenohjata.</p> <p></p> <p>Lis\u00e4tietoa: Rahti Docs: Networking</p>"},{"location":"rahti/julkaisu_yksityisesta_repositoriosta/","title":"Julkaisu yksityisest\u00e4 GitHub-repositoriosta","text":"<p>Jotta palvelun julkaisu voidaan automatisoida, sen l\u00e4hdekoodien on oltava Rahti-palvelun build-ty\u00f6kalujen luettavissa. </p> <p>Julkiseen GitHub-repositorioon lukuoikeus on kaikilla, siihen ei tarvita eri toimenpiteit\u00e4. Yksityisest\u00e4 repositoriosta julkaisemista varten pit\u00e4\u00e4 lukuoikeus j\u00e4rjest\u00e4\u00e4 erikseen.</p> <p>Julkaisua varten kannattaa luoda uusi SSH-avainpari juuri t\u00e4t\u00e4 projektia ja repositoriota varten. Henkil\u00f6kohtaista SSH-avainta ei ole tarkoituksenmukaista k\u00e4ytt\u00e4\u00e4 julkaisuun, sill\u00e4 julkaisuun tarvitaan yksityinen SSH-avain.</p> <p>Luo sopivaan hakemistoon projektin ulkopuolella uusi avainpari. Salasanaa ei pid\u00e4 m\u00e4\u00e4ritt\u00e4\u00e4.</p> <pre><code>ssh-keygen -C \"rahti-build@repo-url\" -f id_rahti_build -N=\"\"\n</code></pre> <ul> <li><code>-C</code> lis\u00e4\u00e4  avaintiedostoon kommentin, josta selvi\u00e4\u00e4, mik\u00e4 avain on kyseess\u00e4, t\u00e4ss\u00e4 <code>rahti-build@repo-url</code></li> <li><code>-f</code> m\u00e4\u00e4ritt\u00e4\u00e4 tiedostonimen, t\u00e4ss\u00e4 <code>id_rahti_build</code></li> <li><code>-N</code> m\u00e4\u00e4ritt\u00e4\u00e4, ett\u00e4 ei k\u00e4ytet\u00e4 salasanaa</li> </ul> <p>Lis\u00e4\u00e4 julkinen avain GitHub-repositorioon GitHubin k\u00e4ytt\u00f6liittym\u00e4ss\u00e4. Esimerkiss\u00e4 luodussa avainparissa julkinen avain on tiedostossa nimelt\u00e4 <code>id_rahti_build.pub</code>.</p> <p></p> <p>Title on GitHubin k\u00e4ytt\u00f6liittym\u00e4ss\u00e4 n\u00e4kyv\u00e4 nimi avaimelle. Julkaisuun ei tarvita kirjoitusoikeuksia. </p> <p>Lis\u00e4\u00e4 yksityinen SSH-avain projektiin luomalla sit\u00e4 varten salaisuus. Esimerkiss\u00e4 salaisuuden nimi on  <code>github-secret</code> ja yksityinen avain on tiedostossa <code>id_rahti_build</code>.</p> <pre><code>oc create secret generic github-secret --from-file=ssh-privatekey=id_rahti_build --type=kubernetes.io/ssh-auth\n</code></pre> <p>Avainsalaisuus pit\u00e4\u00e4 viel\u00e4 liitt\u00e4\u00e4 Rahdin builder-palveluun <pre><code>oc secrets link builder github-secret\n</code></pre></p>"},{"location":"rahti/komentorivityokalun_asennus/","title":"Komentorivity\u00f6kalun asennus ja k\u00e4ytt\u00f6","text":""},{"location":"rahti/komentorivityokalun_asennus/#openshift-komentorivityokalun-asennus","title":"Openshift-komentorivity\u00f6kalun asennus","text":"<p>Red Hat tarjoaa ty\u00f6kalun nimelt\u00e4\u00e4n <code>oc</code> OpenShift ymp\u00e4rist\u00f6n hallintaan komentorivilt\u00e4 k\u00e4sin. Linkki <code>oc</code>-ty\u00f6kalun lataamiseen l\u00f6ytyy Rahti-palvelun hallintan\u00e4kym\u00e4st\u00e4.</p> <p></p> <p>Linkist\u00e4 avautuvalta sivustolta voi ladata omalle k\u00e4ytt\u00f6j\u00e4rjestelm\u00e4lle soveltuvan version. Linkeist\u00e4 latautuu yksitt\u00e4inen, suoritettava tiedosto nimelt\u00e4\u00e4n <code>oc</code>. Kyseisen tiedoston tulee l\u00f6yty\u00e4 k\u00e4ytt\u00f6j\u00e4rjestelm\u00e4n polusta (esim. Windows-ymp\u00e4rist\u00f6n <code>PATH</code>-muuttujan m\u00e4\u00e4ritt\u00e4m\u00e4ss\u00e4 sijainnissa) tai sen Spring-sovelluksen hakemistosta, mist\u00e4 komentoja suoritetaan.</p> <p>Jatkossa oletetaan, ett\u00e4 <code>oc</code>-ty\u00f6kalu on asennettu polkuun. </p>"},{"location":"rahti/komentorivityokalun_asennus/#asennus-windows-ymparistossa","title":"Asennus Windows-ymp\u00e4rist\u00f6ss\u00e4","text":"<p>Kopioi <code>oc.exe</code> johonkin hakemistoon koneellasi (esimerkiss\u00e4 <code>c:\\openshift\\CLI</code>) ja lis\u00e4\u00e4 hakemisto polkuun.</p> <pre><code>$Path = [Environment]::GetEnvironmentVariable(\"PATH\", \"User\") + [IO.Path]::PathSeparator + \"C:\\openshift\\CLI\"\n[Environment]::SetEnvironmentVariable( \"Path\", $Path, \"User\" )\n</code></pre>"},{"location":"rahti/komentorivityokalun_asennus/#rahti-palveluun-kirjautuminen-komentorivilla","title":"Rahti-palveluun kirjautuminen komentorivill\u00e4","text":"<p>Jotta <code>oc</code>-komentoja voi antaa, on kirjauduttava Rahti-palveluun komentorivin kautta. </p> <p>Kirjautumiskomennon saa web k\u00e4ytt\u00f6liittym\u00e4n\u00e4kym\u00e4n oikeasta yl\u00e4kulmasta oma nimi ja sen alta avautuvasta valikosta Copy Login Command.</p> <p></p> <p>Turvallisuussyist\u00e4 Rahti-palvelu pyyt\u00e4\u00e4 k\u00e4ytt\u00e4j\u00e4\u00e4 kirjautumaan palveluun uudelleen.</p> <p>Uudelleenkirjautumisen j\u00e4lkeen, klikkaa 'Display Token' linkki\u00e4 ja liit\u00e4 komento leikep\u00f6yd\u00e4lt\u00e4 paikallisen koneesi komentoriville ja suorita se projektin juurihakemistossa.  </p> <p>Huom! Jos <code>oc</code>-komento ei ole polussa, voi olla tarpeen antaa komennonlle my\u00f6s polku, esim. <pre><code>./oc login https://api.2.rahti.csc.fi:6443 -token=...\n</code></pre></p>"},{"location":"rahti/projektin_luonti/","title":"Rahti-projektin luonti","text":"<p>Jotta Rahti-palvelua voi k\u00e4ytt\u00e4\u00e4, pit\u00e4\u00e4 sen olla otettuna k\u00e4ytt\u00f6\u00f6n MyCSC projektissa ja itse Rahti-palveluun pit\u00e4\u00e4 olla m\u00e4\u00e4riteltyn\u00e4 Rahti-projekti. </p> <p>Avaa Rahti-palvelun web-k\u00e4ytt\u00f6liittym\u00e4 osoitteessa https://rahti.csc.fi, valitse Rahti-2 ja kirjaudu palveluun CSC-tunnuksellasi. Kirjautumisen j\u00e4lkeen palvelun etusivu n\u00e4ytt\u00e4\u00e4 t\u00e4lt\u00e4:</p> <p></p> <p>Lis\u00e4\u00e4 itsellesi Rahti-projekti painamalla aloitussivun \u2019Create a new project\u2019 linkki\u00e4. Anna projektille kuvaava nimi.</p> <p></p> <p>MyCSC:n projektin\u00e4kym\u00e4ss\u00e4 n\u00e4kyv\u00e4 projektinumero tulee mainita Rahti-projektin kuvauskent\u00e4ss\u00e4 projektia luotaessa. T\u00e4ll\u00e4 mekanismilla palvelun k\u00e4yt\u00f6st\u00e4 syntyneet kulut kohdennetaan m\u00e4\u00e4riteltyyn MyCSC projektiin.</p> <p>Kirjaa projektinumero projektin kommenttikentt\u00e4\u00e4n seuraavasti: <pre><code>csc_project:&lt;projektinumero&gt;\n</code></pre> Korvaa \\ oman MyCSC projektisi numerosarjalla. <p>Kun painat Create, luodaan Rahti-projekti, johon voidaan m\u00e4\u00e4ritell\u00e4 tarvittavia palveluja ja resursseja.</p>"},{"location":"rahti/projektin_luonti/#jasenten-lisaaminen-rahti-projektiin","title":"J\u00e4senten lis\u00e4\u00e4minen Rahti-projektiin","text":"<p>Rahti-projektit ovat sidottuja MyCSC projekteihin ja oletuksena n\u00e4kyv\u00e4t vain MyCSC projektin j\u00e4senille. Projektiin voidaan lis\u00e4t\u00e4 muita k\u00e4ytt\u00e4ji\u00e4 heid\u00e4n CSC-tunnuksillaan Administrator/User Management/RoleBindings-asetuksen kautta.</p> <p></p> <p>Voit Rahti-projektin omistajana n\u00e4in lis\u00e4t\u00e4 kurssin opettajan omaan projektiisi. </p>"},{"location":"rahti/projektin_luonti/#projektin-luominen-komentorivikomennoin","title":"Projektin luominen komentorivikomennoin","text":"<p>Voit luoda Rahti-projektin my\u00f6s komentorivilt\u00e4 <code>oc</code>-komennoin. Seuraavissa esimerkeiss\u00e4 luotavan projektin nimi on <code>myproj</code>.</p> <pre><code>oc new-project myproj --description='csc_project:200xxxx'\n</code></pre> <ul> <li><code>xxxx</code> korvataan oman CSC-projektin tunnisteen nelj\u00e4ll\u00e4 viimeisell\u00e4 numerolla</li> </ul>"},{"location":"rahti/react_julkaiseminen/","title":"React-sovelluksen julkaiseminen","text":""},{"location":"rahti/react_julkaiseminen/#sovelluksen-valmistelu-julkaisua-varten","title":"Sovelluksen valmistelu julkaisua varten","text":"<p>Julkaisu tehd\u00e4\u00e4n k\u00e4ytt\u00e4en Docker-konttia. Kontin levykuva tekee ensin React-buildin ja k\u00e4ynnist\u00e4\u00e4 sitten nginx-web-palvelimen jakamaan sovellusta.</p> <p>Lis\u00e4\u00e4 projektin juureen Dockerfile-niminen tiedosto, jonka sis\u00e4lt\u00f6 on seuraava: <pre><code># Use an official Node runtime as a parent image\nFROM node:19-alpine AS build\n# Set the working directory to /app\nWORKDIR /app\n# Copy the package.json and package-lock.json to the container\nCOPY package*.json ./\n# Install dependencies\nRUN npm ci\n# Copy the rest of the application code to the container\nCOPY . .\n# Build the React app\nRUN npm run build\n\nFROM nginx:alpine\n# Support running as arbitrary user which belongs to the root group\n# Note that users are not allowed to listen on privileged ports (&lt; 1024)\nRUN chmod g+rwx /var/cache/nginx /var/run /var/log/nginx &amp;&amp; \\\n    chown nginx.root /var/cache/nginx /var/run /var/log/nginx &amp;&amp; \\\n    # Make /etc/nginx/html/ available to use\n    mkdir -p /etc/nginx/html/ &amp;&amp; chmod 777 /etc/nginx/html/ &amp;&amp; \\\n    # comment user directive as master process is run as user in OpenShift anyhow\n    sed -i.bak 's/^user/#user/' /etc/nginx/nginx.conf\n# Copy React build to nginx HTML directory \nCOPY --from=build /app/&lt;build-dir&gt; /usr/share/nginx/html/\n# Copy nginx-configuration file \nCOPY nginx.conf /etc/nginx/conf.d/default.conf\n\nWORKDIR /usr/share/nginx/html/\nEXPOSE 8080\nUSER nginx:root\n</code></pre></p> <ul> <li><code>&lt;build-dir&gt;</code> on hakemisto, johon React build tehtiin. </li> </ul> <p>Konfiguroi tiedostoon oikea build-hakemisto: Vite-ymp\u00e4rist\u00f6ss\u00e4 hakemisto on oletusarvoisesti <code>dist</code>, Create React App -ymp\u00e4rist\u00f6ss\u00e4 <code>build</code></p> <p>Lis\u00e4\u00e4 projektin juureen nginx-konfiguraatiotiedosto <code>nginx.conf</code> seuraavalla sis\u00e4ll\u00f6ll\u00e4: <pre><code>server {\n  listen 8080;\n  root /usr/share/nginx/html;\n  location / {\n    index  index.html\n    try_files $uri $uri/ /index.html;\n  }\n}\n</code></pre></p> <p>Dockerfilen toimivuus kannattaa testata paikallisessa Docker-ymp\u00e4rist\u00f6ss\u00e4. Asenna Docker, k\u00e4ynnist\u00e4 Docker Desktop ja anna projektin juuressa komennot: <pre><code>docker build -t myimage .\ndocker run -p 80:8080 --name myapp myimage\n</code></pre> Sovelluksen pit\u00e4isi vastata osoitteesta http://localhost:80.</p>"},{"location":"rahti/react_julkaiseminen/#julkaisu","title":"Julkaisu","text":"<p>Jotta t\u00e4ss\u00e4 luvussa k\u00e4ytett\u00e4vi\u00e4 <code>oc</code>-komentoja voi antaa, on ensin kirjauduttava Rahti-palveluun luvun Rahti-palveluun kirjautuminen komentorivill\u00e4 ohjeiden mukaisesti.</p> <p>Jos repositorio on julkinen, voit luoda projektiin sovelluksen (application) komennolla: <pre><code>oc new-app &lt;repository-URL&gt;#&lt;branch-name&gt;\n</code></pre></p> <ul> <li><code>&lt;repository-URL&gt;</code> on osoite, josta repositorion voi kloonata</li> <li><code>&lt;branch-name&gt;</code> on haara, josta julkaistaan.</li> </ul> <p>Jos repositorio on yksityinen, on komentoon lis\u00e4tt\u00e4v\u00e4 tieto k\u00e4ytett\u00e4v\u00e4st\u00e4 SSH-avaimesta:</p> <pre><code>oc new-app &lt;repository-URL&gt;#&lt;branch-name&gt; --source-secret=&lt;github-secret&gt;\n</code></pre> <ul> <li><code>&lt;github-secret&gt;</code> on SSH-avaimen sis\u00e4lt\u00e4v\u00e4n salaisuuden nimi.</li> </ul> <p>Tuloksena syntyy build config ja build k\u00e4ynnistyy. Voit seurata buildin etenemist\u00e4 web-k\u00e4ytt\u00f6liittym\u00e4ss\u00e4.</p> <p>Kun julkaisu on onnistunut, projektiin on ilmaantunut deployment-konfiguraatio sek\u00e4 toivottavasti k\u00e4ynniss\u00e4 oleva palvelu.</p> <p>Kun palvelu on luotu. tarvitaan viel\u00e4 reitti:</p> <pre><code>oc expose service &lt;service-name&gt;\n</code></pre> <ul> <li><code>&lt;service-name&gt;</code> on \u00e4sken luodun palvelun nimi, oletusarvoisesti sama kuin  <p>T\u00e4ll\u00e4 syntyy reittikin, ja palvelu on julkaistu verkkoon HTTP-protokollalla. Jos halutaan https-p\u00e4\u00e4sy, on se konfiguroitava erikseen, ks. luku HTTPS-konfigurointi</p>"},{"location":"rahti/react_julkaiseminen/#buildin-kaynnistaminen","title":"Buildin k\u00e4ynnist\u00e4minen","text":"<p>Julkaisun j\u00e4lkeen uusi julkaisu voidaan k\u00e4ynnist\u00e4\u00e4 manuaalisesti web-k\u00e4ytt\u00f6liittym\u00e4st\u00e4 tai komentorivill\u00e4 <code>oc</code>-komennolla.  </p> <pre><code>oc start-build &lt;build-config-name&gt;\n</code></pre> <ul> <li><code>&lt;build-config-name&gt;</code> on oletusarvoisesti sama kuin <code>&lt;deployment-config-name&gt;</code></li> </ul> <p>Build voidaan my\u00f6s automatisoida tapahtumaan aina, kun GitHub-repositorioon pusketaan uusi versio l\u00e4hdekoodista.</p>"},{"location":"rahti/spring_ilman_tietokantaa/","title":"Spring Boot -palvelimen julkaisu ilman ulkoista tietokantaa","text":"<p>Seuraavassa k\u00e4yd\u00e4\u00e4n l\u00e4pi Spring Boot -palvelimen julkaisu ilman ulkoista tietokantaa.</p> <p>Tietokannan konfigurointi k\u00e4sitell\u00e4\u00e4n seuraavassa luvussa.</p> <p>Huom! Jotta t\u00e4ss\u00e4 luvussa k\u00e4ytett\u00e4vi\u00e4 <code>oc</code>-komentoja voi antaa, on ensin kirjauduttava Rahti-palveluun luvun Rahti-palveluun kirjautuminen komentorivill\u00e4 ohjeiden mukaisesti.</p> <p>Kirjaudu ensin Rahti-palveluun komentorivill\u00e4 ja aseta luomasi projekti aktiiviseksi.</p> <pre><code>oc project myproject\n</code></pre>"},{"location":"rahti/spring_ilman_tietokantaa/#sovelluksen-luonti","title":"Sovelluksen luonti","text":"<p>Rahti-palvelun ty\u00f6kaluilla voidaan luoda sovelluksen julkaisuun tarvittavat resurssit repositorion sis\u00e4ll\u00f6n perusteella automaattisesti. Resurssit voidaan luoda joko suoraan l\u00e4hdekoodin perusteella (Source-to-Image, S2I) tai projektissa m\u00e4\u00e4ritetyn Dockerfile:n perusteella. </p> <p>Uusi sovellus voidaan luoda komentorivikomennolla <code>oc new-app</code>. Komennolle annetaan parametrina repositorio-osoite, josta projekti k\u00e4yd\u00e4\u00e4n hakemassa. </p>"},{"location":"rahti/spring_ilman_tietokantaa/#sovellusprojektin-sijainti-repositoriossa","title":"Sovellusprojektin sijainti repositoriossa","text":"<p>Build-ty\u00f6kalut olettavat, ett\u00e4 sovellusprojekti sijaitsee repositorion juurihakemistossa. Jos n\u00e4in ei ole, voidaan projektihakemisto antaa <code>oc new-app</code>-komennossa valitsinparametrilla <code>--context-dir</code>:</p> <p><pre><code>--context-dir=&lt;projektihakemisto&gt;\n</code></pre> - <code>&lt;projektihakemisto&gt;</code> on suhteellinen polku repositorion juuresta siihen hakemistoon, jossa sovellusprojekti sijaitsee, esim. <code>--context-dir=myproj</code>. </p>"},{"location":"rahti/spring_ilman_tietokantaa/#repositorio-oikeudet","title":"Repositorio-oikeudet","text":"<p>Rahti-ty\u00f6kalut tarvitsevat p\u00e4\u00e4syn projektin repositorioon. Jos repositorio on julkinen, ei p\u00e4\u00e4syoikeuksia tarvitse erikseen m\u00e4\u00e4ritt\u00e4\u00e4.</p> <p>Jos repositorio on yksityinen, on Rahti-projektille j\u00e4rjestett\u00e4v\u00e4 p\u00e4\u00e4sy luvun Julkaisu yksityisest\u00e4 GitHub-repositoriosta ohjeiden mukaisesti, ja annettavissa komennoissa on lis\u00e4ksi annettava  tieto tarvittavasta SSH-avaimesta valitsimella </p> <pre><code>--source-secret=&lt;github-creds-secret-name&gt;\n</code></pre> <ul> <li><code>&lt;github-creds-secret-name&gt;</code> on salaisuus, joka sis\u00e4lt\u00e4\u00e4 yksityisen SSH-avaimen.</li> </ul> <p>T\u00e4ss\u00e4 tapauksessa repositorion osoite pit\u00e4\u00e4 antaa SSH-muodossa, esim:</p> <p><pre><code>git@github.com:&lt;user&gt;/&lt;repositorionimi&gt;.git\n</code></pre> </p>"},{"location":"rahti/spring_ilman_tietokantaa/#sovelluksen-luontikomennot","title":"Sovelluksen luontikomennot","text":"<p>Seuraavissa esimerkeiss\u00e4 k\u00e4yd\u00e4\u00e4n l\u00e4pi sovelluksen luonti molemmilla edell\u00e4 mainituilla tavoilla. Kaikki komennot tehd\u00e4\u00e4n komentorivilt\u00e4. </p> Dockerfilen perusteellaSource-to-Image-ty\u00f6kaluilla <p>Lis\u00e4\u00e4 Spring Boot projektin juureen tiedosto <code>Dockerfile</code>, jonka sis\u00e4lt\u00f6 on seuraava:</p> <p><pre><code>FROM eclipse-temurin:17-jdk-focal as builder\nWORKDIR /opt/app\nCOPY .mvn/ .mvn\nCOPY mvnw pom.xml ./\nRUN chmod +x ./mvnw\nRUN ./mvnw dependency:go-offline\nCOPY ./src ./src\nRUN ./mvnw clean install -DskipTests \nRUN find ./target -type f -name '*.jar' -exec cp {} /opt/app/app.jar \\; -quit\n\nFROM eclipse-temurin:17-jre-alpine\nCOPY --from=builder /opt/app/*.jar /opt/app/\nEXPOSE 8080\nENTRYPOINT [\"java\", \"-jar\", \"/opt/app/app.jar\" ]\n</code></pre> M\u00e4\u00e4ritys on laadittu yleisk\u00e4ytt\u00f6iseksi, sen pit\u00e4isi toimia miss\u00e4 tahansa Spring Boot -projektissa sellaisenaan.</p> <p>Jos repositorio on julkinen, voit luoda projektiin sovelluksen (application) komennolla: <pre><code>oc new-app &lt;repository-URL&gt;#&lt;branch-name&gt;\n</code></pre> - <code>&lt;repository-URL&gt;</code> on osoite, josta repositorion voi kloonata - <code>&lt;branch-name&gt;</code> on haara, josta julkaistaan.</p> <p>Jos repositorio on yksityinen, on komentoon lis\u00e4tt\u00e4v\u00e4 tieto k\u00e4ytett\u00e4v\u00e4st\u00e4 SSH-avaimesta:</p> <pre><code>oc new-app &lt;repository-URL&gt;#&lt;branch-name&gt; --source-secret=&lt;github-creds-secret-name&gt;\n</code></pre> <p>Jos repositorio on julkinen, voit luoda projektiin sovelluksen (application) komennolla:</p> <p><pre><code>oc new-app registry.access.redhat.com/ubi8/openjdk-17:1.18-2~&lt;repository-URL&gt;#&lt;branch-name&gt;\n</code></pre> - <code>registry.access.redhat.com/ubi8/openjdk-17:1.18-2</code> on S2I-ty\u00f6kalulevykuva Java 17-sovelluksille - <code>&lt;repositorio-URL&gt;</code> on osoite, josta repositorion voi kloonata - <code>&lt;branch-name&gt;</code> on haara, josta julkaistaan.</p> <p>Jos repositorio on yksityinen, on komentoon lis\u00e4tt\u00e4v\u00e4 tieto k\u00e4ytett\u00e4v\u00e4st\u00e4 SSH-avaimesta: <pre><code>oc new-app registry.access.redhat.com/ubi8/openjdk-17:1.18-2~&lt;repository-URL&gt;#&lt;branch-name&gt; --source-secret=&lt;github-creds-secret-name&gt;\n</code></pre></p> <p>Komennon tuloksena syntyy build config ja build k\u00e4ynnistyy. Voit seurata buildin etenemist\u00e4 web-k\u00e4ytt\u00f6liittym\u00e4ss\u00e4.</p> <p>Kun julkaisu on onnistunut, projektiin on ilmaantunut deployment-konfiguraatio (deployment configuration), palvelu (service) sek\u00e4 toivottavasti k\u00e4ynniss\u00e4 oleva kontti. Jos n\u00e4in ei ole, tilannetta voi selvitell\u00e4 luvun Virheenj\u00e4ljitys ohjeiden avulla.</p> <p>T\u00e4m\u00e4n j\u00e4lkeen on viel\u00e4 avattava palvelulle reitti (route), jolla palveluun p\u00e4\u00e4see internetist\u00e4. Sen voi tehd\u00e4 komennolla:</p> <p><pre><code>oc expose service &lt;service-name&gt;\n</code></pre> - <code>&lt;service-name&gt;</code> on \u00e4sken luodun palvelun nimi, oletusarvoisesti sama kuin sovelluksen nimi. Sovelluksen palvelut voi katsoa web-k\u00e4ytt\u00f6liittym\u00e4st\u00e4 tai listata komennolla <code>oc get svc</code>.</p> <p>Oletusarvoisesti luodaan salaamaton http-reitti. Jos halutaan https-p\u00e4\u00e4sy, on se konfiguroitava erikseen, ks. luku HTTPS-konfigurointi</p>"},{"location":"rahti/spring_ilman_tietokantaa/#buildin-kaynnistaminen","title":"Buildin k\u00e4ynnist\u00e4minen","text":"<p>Julkaisun j\u00e4lkeen uusi julkaisu voidaan k\u00e4ynnist\u00e4\u00e4 manuaalisesti web-k\u00e4ytt\u00f6liittym\u00e4st\u00e4 tai komentorivill\u00e4 <code>oc</code>-komennolla. <pre><code>oc start-build &lt;build-config-name&gt;\n</code></pre> - <code>&lt;build-config-name&gt;</code> on oletusarvoisesti sama kuin <code>&lt;deployment-config-name&gt;</code></p> <p>Build voidaan my\u00f6s automatisoida tapahtumaan aina, kun GitHub-repositorioon pusketaan uusi versio l\u00e4hdekoodista</p>"},{"location":"rahti/spring_jkube_plugin/","title":"Julkaisu paikallisesta hakemistosta JKube OpenShift Maven pluginilla","text":"<p>Eclipse JKube on kokoelma lis\u00e4osia ja kirjastoja, joiden avulla helpotetaan Java-ohjelmistojen kontittamista ja julkaisua OpenShift konttipalveluun. JKube OpenShift Maven pluginilla voidaan julkaista sovellus kehitysymp\u00e4rist\u00f6st\u00e4 suoraan paikallisesta hakemistosta (siis ei GitHub-repositoriosta). </p> <p>T\u00e4t\u00e4 julkaisua ei voi samalla tavoin automatisoida kuin GitHubista teht\u00e4vi\u00e4 julkaisuja.</p> <p>Lis\u00e4osan k\u00e4ytt\u00f6\u00f6notto on suoraviivaista: Lis\u00e4\u00e4 Spring Boot projektin pom.xml tiedostoon JKube-lis\u00e4osan m\u00e4\u00e4ritys:</p> <pre><code>&lt;build&gt;\n    &lt;plugins&gt;\n\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.eclipse.jkube&lt;/groupId&gt;\n            &lt;artifactId&gt;openshift-maven-plugin&lt;/artifactId&gt;\n        &lt;/plugin&gt;\n\n    &lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre> <p>Kirjaudu rahti-palveluun komentorivin kautta.T\u00e4m\u00e4n j\u00e4lkeen julkaisu voidaan tehd\u00e4 maven -komennolla:</p> <p><pre><code>./mvnw package oc:build oc:resource oc:apply\n</code></pre> Komento valmistelee Java projektin, luo ja alustaa OpenShift ymp\u00e4rist\u00f6\u00f6n soveltuvan kontin ja lataa kontin suoritukseen OpenShift ymp\u00e4rist\u00f6\u00f6n.</p> <p>Komennon p\u00e4\u00e4ttymisen j\u00e4lkeen Rahti-projektin Overview-n\u00e4kym\u00e4st\u00e4 voit saada tietoa julkaisun tilasta ja onnistumisesta, sek\u00e4 l\u00f6yd\u00e4t julkaistun palvelun URL-osoitteen.</p> <p></p>"},{"location":"rahti/spring_jkube_plugin/#ymparistomuuttujien-asettaminen-jkube-openshift-maven-pluginia-kaytettaessa","title":"Ymp\u00e4rist\u00f6muuttujien asettaminen JKube OpenShift Maven pluginia k\u00e4ytett\u00e4ess\u00e4","text":"<p>Koska OpenShift Maven plugin yliajaa kaikki web-k\u00e4ytt\u00f6liittym\u00e4ss\u00e4 tehdyt konttiasetukset, on sit\u00e4 k\u00e4ytett\u00e4ess\u00e4 m\u00e4\u00e4ritykset teht\u00e4v\u00e4 pluginin m\u00e4\u00e4ritystiedostossa.</p> <p>Tarkista Rahti-palvelun hallintak\u00e4ytt\u00f6liittym\u00e4st\u00e4 tietokannan luonnin yhteydess\u00e4 luodun salaisuuden nimi. T\u00e4ss\u00e4 esimerkiss\u00e4 se on <code>mysql-secret</code>. </p> <p>Lis\u00e4\u00e4 Spring sovelluksen hakemistorakenteeseen <code>src/main/jkube</code> tiedosto nimelt\u00e4\u00e4n <code>deployment.yml</code>. <pre><code>spec:\n  template:\n    spec:\n      containers:\n        - env:\n            - name: MYSQL_USER\n              valueFrom:\n                secretKeyRef:\n                  key: database-user\n                  name: mysql-secret\n            - name: MYSQL_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  key: database-password\n                  name: mysql-secret\n            - name: MYSQL_DATABASE\n              valueFrom:\n                secretKeyRef:\n                  key: database-name\n                  name: mysql-secret\n            - name: SPRING_PROFILES_ACTIVE\n              value: rahti\n</code></pre></p> <p>Parametrien selitykset: - <code>name</code> on asetettavan ymp\u00e4rist\u00f6muuttujan nimi - <code>valueFrom.secretKeyRef.name</code> m\u00e4\u00e4ritt\u00e4\u00e4, mink\u00e4 nimisest\u00e4 salaisuudesta arvo luetaan. Vaihda t\u00e4h\u00e4n omasta ymp\u00e4rist\u00f6st\u00e4si oikea salaisuuden nimi. - <code>valueFrom.secretKeyRef.key</code> m\u00e4\u00e4ritt\u00e4\u00e4, mist\u00e4 salaisuuden kent\u00e4st\u00e4 arvo luetaan. - Lopuksi asetaan ymp\u00e4rist\u00f6muuttujan SPRING_PROFILES_ACTIVE arvoksi halutun profiilin nimi. K\u00e4ytett\u00e4v\u00e4 Spring-profiili voidaan asettaa ymp\u00e4rist\u00f6muuttujalla SPRING_PROFILES_ACTIVE.</p> <p>Huomaa, ett\u00e4 tiedostomuoto on YAML. Sen rakenteeseen on tarvittaessa hyv\u00e4 hakea vinkki\u00e4 web-k\u00e4ytt\u00f6liittym\u00e4st\u00e4 valitsemalla tietokantapodin valikosta Edit YAML.</p> <p>Suorita uudelleen komento  <pre><code> ./mvnw package oc:build oc:resource oc:apply\n</code></pre> Rahti-projektin Overview-n\u00e4kym\u00e4ss\u00e4 voi seurata julkaisun etenemist\u00e4. Onnistuneen julkaisun j\u00e4lkeen n\u00e4kym\u00e4ss\u00e4 n\u00e4kyy, ett\u00e4 sek\u00e4 sovelluspalvelinkontti(Spring Boot-palvelin) ett\u00e4 tietokantapalvelinkontti ovat k\u00e4ynniss\u00e4.</p> <p></p>"},{"location":"rahti/spring_tietokannan_konfigurointi/","title":"Spring Boot -palvelimen konfigurointi k\u00e4ytt\u00e4m\u00e4\u00e4n ulkoista tietokantapalvelua","text":"<p>Seuraavassa esimerkiss\u00e4 konfiguroidaan Spring Boot -palvelin k\u00e4ytt\u00e4m\u00e4\u00e4n projektiin luotua tietokantapalvelua.</p> <p>Esimerkiss\u00e4 palvelimessa k\u00e4ytett\u00e4v\u00e4n tietokannan asetukset hallitaan k\u00e4ytt\u00e4m\u00e4ll\u00e4 Spring-profiileja: julkaisun tietokantakonfiguraatiota varten m\u00e4\u00e4ritell\u00e4\u00e4n oma profiili, joka m\u00e4\u00e4ritell\u00e4\u00e4n otettavaksi k\u00e4ytt\u00f6\u00f6n julkaisuymp\u00e4rist\u00f6ss\u00e4.</p>"},{"location":"rahti/spring_tietokannan_konfigurointi/#julkaisuprofiilin-luonti-spring-projektiin","title":"Julkaisuprofiilin luonti Spring-projektiin","text":"<p>Profiili voidaan m\u00e4\u00e4ritell\u00e4 laatimalla projektiin profiilikohtainen <code>application.properties</code>-m\u00e4\u00e4ritys. Sen nimeksi tulee asettaa <code>application-&lt;profiilinimi&gt;.properties</code>. Jos esimerkiksi profiilin nimeksi valitaan <code>rahti</code>, tiedoston nimi on <code>application-rahti.properties</code>.</p> <p>Profiilikohtaiset asetukset luetaan globaalien asetusten lis\u00e4ksi. N\u00e4in esim. julkaisukonfiguraatioparametrit voidaan m\u00e4\u00e4ritell\u00e4 jokaista julkaisuymp\u00e4rist\u00f6\u00e4 varten eri tiedostoihin.</p> <p>Seuraavassa esimerkiss\u00e4 k\u00e4ytet\u00e4\u00e4n palvelimen ajoymp\u00e4rist\u00f6st\u00e4 luettavia ymp\u00e4rist\u00f6muuttuja-arvoja. N\u00e4in julkaisuymp\u00e4rist\u00f6n konfiguraatioparametreja ei tarvitse vied\u00e4 versionhallintaan.</p> <p>Rahti-projektiin luotavat kontit saavat projektiin luodun tietokantapalvelun tiedot ajoymp\u00e4rist\u00f6\u00f6n m\u00e4\u00e4ritetyist\u00e4 ymp\u00e4rist\u00f6muuttujista, joiden nimi muodostetaan tietokantapalvelun nimen perusteella seuraavasti: <pre><code>  &lt;tietokantapalvelun nimi&gt;_SERVICE_HOST\n  &lt;tietokantapalvelun nimi&gt;_SERVICE_PORT\n</code></pre></p> <p>Voit avata kontin Terminal-n\u00e4kym\u00e4n ja tarkastella ymp\u00e4rist\u00f6muuttujia <code>env</code> komennolla. Alla olevassa kuvassa ymp\u00e4rist\u00f6muuttujista on listattu muuttujat, jotka kertovat tietokantapalvelun, jonka nimi on <code>mysql-service</code>, tiedot muille Rahti-projektin konteille.</p> <p></p> <p>Esimerkki profiilim\u00e4\u00e4ritystiedoston sis\u00e4ll\u00f6st\u00e4, jos tietokantapalvelun nimeksi on asetettu <code>db-service</code>: <pre><code>spring.datasource.url=jdbc:mysql://${DB_SERVICE_SERVICE_HOST}:${DB_SERVICE_SERVICE_PORT}/${DB_NAME}\nspring.datasource.username=${DB_USER}\nspring.datasource.password=${DB_PASSWORD}\nspring.jpa.show-sql=true\nspring.jpa.generate-ddl=true\nspring.jpa.hibernate.ddl-auto=update\n</code></pre></p> <p>Huom: Tietokantapalvelinta kytkett\u00e4ess\u00e4 muihin kontteihin, on t\u00e4rke\u00e4\u00e4 k\u00e4ytt\u00e4\u00e4 muuttujanimi\u00e4 eik\u00e4 esim. IP-osoitetta suoraan. IP-osoitteet voivat muuttua esimerkiksi kontin uudelleen k\u00e4ynnistymisen yhteydess\u00e4</p>"},{"location":"rahti/spring_tietokannan_konfigurointi/#ymparistomuuttujien-asettaminen","title":"Ymp\u00e4rist\u00f6muuttujien asettaminen","text":"<p>Profiiliin m\u00e4\u00e4ritellyt ymp\u00e4rist\u00f6muuttujat pit\u00e4\u00e4 viel\u00e4 asettaa. Voit m\u00e4\u00e4ritell\u00e4 k\u00e4ynnistett\u00e4v\u00e4lle kontille ymp\u00e4rist\u00f6muuttujia Rahti-palvelun web-k\u00e4ytt\u00f6liittym\u00e4ss\u00e4 kohdassa Applications/Deployments:</p> <p></p> <p>Ymp\u00e4rist\u00f6muuttujan arvon voidaan m\u00e4\u00e4ritell\u00e4 suoraan tai valita sen jostain projektiin luodusta salaisuudesta. </p> <p>Yll\u00e4olevassa esimerkiss\u00e4 MySQL-tietokannan tietokantak\u00e4ytt\u00e4j\u00e4n nimi <code>DB_USER</code> ja salasana <code>DB_PASSWORD</code> sek\u00e4 tietokannan nimi <code>DB_NAME</code> luetaan salaisuudesta, joka luotiin tietokantapalvelun lis\u00e4\u00e4misen yhteydess\u00e4. </p> <p>Ymp\u00e4rist\u00f6muuttuja <code>SPRING_PROFILES_ACTIVE</code> m\u00e4\u00e4ritt\u00e4\u00e4, mik\u00e4 profiili asetetaan aktiiviseksi. Sen arvoksi m\u00e4\u00e4ritet\u00e4\u00e4n suoraan julkaisuprofiilin nimi.  </p> <p>Kun julkaisu seuraavan kerran tehd\u00e4\u00e4n, k\u00e4ynnistyv\u00e4ss\u00e4 kontissa ymp\u00e4rist\u00f6muuttujat on m\u00e4\u00e4ritelty ja Spring ottaa oikean profiilin k\u00e4ytt\u00f6\u00f6n.</p>"},{"location":"rahti/tietokantapalvelun_luominen/","title":"Tietokantapalvelun luominen","text":"<p>Rahti-projektiin voi lis\u00e4t\u00e4 esivalmisteltuja kontteja Developer/+Add-n\u00e4kym\u00e4st\u00e4:</p> <p></p> <p></p> <p>T\u00e4ss\u00e4 esimerkiss\u00e4 k\u00e4ytet\u00e4\u00e4n Database/MySQL-vaihtoehtoa. </p> <p>Huom! Tarjolla olevat Ephemeral-versiot tietokantapalveluista k\u00e4ytt\u00e4v\u00e4t pelk\u00e4st\u00e4\u00e4n v\u00e4liaikaista tallennuskapasiteettia ja kaikki mahdolliset muutokset mm. tietokantaan h\u00e4vi\u00e4v\u00e4t samalla, kun kontin suoritus loppuu. Pysyv\u00e4\u00e4 tallennusta varten tulee valita \"tavallinen\" tietokantapalvelukontti ja sille dedikoitu Persistent Volume Claim (PVC) -tallennustila.</p> <p>Avaa luontivelho painamalla 'Instantiate Template' nappia. Asetuksista kannattaa t\u00e4ydent\u00e4\u00e4 ainakin:</p> <ul> <li>Database Service Name: Tietokantapalvelun nimi. T\u00e4ll\u00e4 nimell\u00e4 muut kontit l\u00f6yt\u00e4v\u00e4t palvelun.</li> <li>MySQLConnection Username: K\u00e4ytt\u00e4j\u00e4tunnus sql-palvelimelle kirjautumiseen.</li> <li>MySQL Connection Password: Salasana sql-palvelimelle kirjautumiseen.</li> <li>MySQL Database Name. Luotavan tietokannan nimi.</li> </ul> <p></p> <p>Luontivelho luo salaisuustiedoston (secret), johon tietokannan konfiguraatiotiedot talletetaan . </p> <p>Salaisuus luodaan, koska sit\u00e4 k\u00e4ytt\u00e4en luottamuksellisia konfiguraatiotietoja ei tarvitse tallettaa versionhallintaan, eik\u00e4 niit\u00e4 tarvitse lainkaan k\u00e4sitell\u00e4 suoraan vaan ne voidaan lukea salaisuustiedostosta.</p> <p></p> <p>Salaisuudet (ja muut vastaavat resurssit) l\u00f6ytyv\u00e4t Rahti-palvelun web-k\u00e4ytt\u00f6liittym\u00e4st\u00e4 Administrator/Workloads-valikon alta. Pelk\u00e4t salaisuudet on n\u00e4ht\u00e4vill\u00e4 my\u00f6s valikosta Developer/Secrets.</p> <p></p>"},{"location":"rahti/virheenjaljitys/","title":"Virheenj\u00e4ljitys","text":""},{"location":"rahti/virheenjaljitys/#podien-tarkastelu","title":"Podien tarkastelu","text":"<p>K\u00e4ynniss\u00e4 olevien konttien (pod) tietoja voidaan tarkastella Rahti-palvelun hallintaliittym\u00e4ss\u00e4.</p> <p>K\u00e4ynniss\u00e4 olevat kontit ja niiden lokit l\u00f6ytyv\u00e4t Developer-n\u00e4kym\u00e4st\u00e4.</p> <p></p> <p>Lokeja voi tarkastella v\u00e4lilehdell\u00e4 Logs:</p> <p></p> <p>Konttiin saa p\u00e4\u00e4teyhteyden v\u00e4lilehdell\u00e4 Terminal:</p> <p></p> <p>Konttiin saa ssh-yhteyden my\u00f6s komentorivill\u00e4 komennolla <code>oc rsh &lt;nimi&gt;</code>. Projektin kontit voi listata komennolla <code>oc get pods</code>.</p> <pre><code>PS &gt; oc get pods\nNAME                  READY     STATUS      RESTARTS   AGE\ndbservice-1-p2smq     1/1       Running     0          4h\nticketguru-11-sbqhn   1/1       Running     0          1h\nPS &gt; oc rsh ticketguru-11-sbqhn\n~ $ \n</code></pre>"},{"location":"rahti/virheenjaljitys/#tietokantapodin-tarkastelu","title":"Tietokantapodin tarkastelu","text":"<p>Tietokantaa voi tarkastella tietokantaj\u00e4rjestelm\u00e4n komentorivity\u00f6kaluilla tietokantakontin p\u00e4\u00e4teyhteydell\u00e4, esim.  <pre><code>$ mysql -u dbuser -p dbname\n</code></pre></p>"},{"location":"rahti/virheenjaljitys/#projektin-uudelleenluonti","title":"Projektin uudelleenluonti","text":"<p>Jos sovelluksen luonti <code>oc new-app</code>-komennolla jostain syyst\u00e4 ei onnistu, komennon uudelleenyritt\u00e4minen voi olla hankalaa, koska joitakin resursseja on jo luotu.</p> <p>Helpointa saattaa olla poistaa koko Rahti-projekti ja luoda se alusta saakka uudelleen komentorivikomennnoin.</p> <p>Seuraavissa esimerkeiss\u00e4 poistettavan ja uudelleen luotavan projektin nimi on <code>myproj</code>.</p> <pre><code>oc delete project myproj\noc new-project myproj --description='csc_project:2xxxxxx'\n</code></pre> <ul> <li><code>xxxxxx</code> korvataan oman CSC-projektin tunnisteen kuudella viimeisell\u00e4 numerolla</li> </ul>"},{"location":"reseptit/react_rahti/","title":"React-sovelluksen julkaiseminen Rahti-ymp\u00e4rist\u00f6ss\u00e4","text":""},{"location":"reseptit/react_rahti/#tavoite","title":"Tavoite","text":"<p>T\u00e4ss\u00e4 ohjeessa k\u00e4yd\u00e4\u00e4n l\u00e4pi React-sovelluksen julkaisu Rahti-palvelussa. </p> <p>Oletuksena on, ett\u00e4</p> <ul> <li>julkaisu tehd\u00e4\u00e4n GitHub-repositoriosta.</li> </ul>"},{"location":"reseptit/react_rahti/#ennakkovaatimukset","title":"Ennakkovaatimukset","text":"<p>Resepti edellytt\u00e4\u00e4 seuraavia toimenpiteit\u00e4:</p> <ul> <li>Komentorivity\u00f6kalun asennus</li> </ul>"},{"location":"reseptit/react_rahti/#resepti","title":"Resepti","text":"<pre><code>flowchart LR\n  classDef highlight fill:#ffe2ff,stroke:#996d99,stroke-width:3px;\n\n  step1[Rahti-projektin luonti]\n  step2[React-sovelluksen julkaisu]\n  step3[Buildin automatisointi]\n\n  step1--&gt;step2\n  step2--&gt;step3</code></pre> <ol> <li>Luo Rahti-projekti</li> <li>Julkaise React-sovellus</li> <li>Automatisoi build (valinnainen)</li> </ol>"},{"location":"reseptit/react_rahti/#lisaohjeita","title":"Lis\u00e4ohjeita","text":"<ul> <li>Virheenj\u00e4ljitys</li> <li>HTTPS-konfigurointi</li> <li>Julkaisu yksityisest\u00e4 repositoriosta</li> </ul>"},{"location":"reseptit/spring_rahti/","title":"Spring Boot -palvelun julkaiseminen Rahti-ymp\u00e4rist\u00f6ss\u00e4","text":""},{"location":"reseptit/spring_rahti/#tavoite","title":"Tavoite","text":"<p>T\u00e4ss\u00e4 ohjeessa k\u00e4yd\u00e4\u00e4n l\u00e4pi Spring-palvelun julkaisu Rahti-palvelussa. </p> <p>Oletuksena on, ett\u00e4 </p> <ul> <li>julkaistavassa palvelussa on Spring-palvelin ja relaatiotietokanta</li> <li>julkaisu tehd\u00e4\u00e4n GitHub-repositoriosta. </li> </ul> <p>Julkaisu tehd\u00e4\u00e4n esimerkiss\u00e4 vaiheittain.</p>"},{"location":"reseptit/spring_rahti/#ennakkovaatimukset","title":"Ennakkovaatimukset","text":"<p>Resepti edellytt\u00e4\u00e4 seuraavia toimenpiteit\u00e4:</p> <ul> <li>Komentorivity\u00f6kalun asennus</li> </ul>"},{"location":"reseptit/spring_rahti/#resepti","title":"Resepti","text":"<pre><code>flowchart LR\n  classDef highlight fill:#ffe2ff,stroke:#996d99,stroke-width:3px;\n\n  step1[Rahti-projektin luonti]\n  step2[Tietokantapalvelun luonti]\n  step3[Spring Boot -palvelimen julkaisu]\n  step4[Tietokannan konfigurointi]\n  step5[Buildin automatisointi]\n\n  step1--&gt;step2\n  step2--&gt;step3\n  step3--&gt;step4\n  step4--&gt;step5</code></pre> <ol> <li>Luo Rahti-projekti</li> <li>Luo projektiin tietokanta</li> <li>Julkaise Spring-palvelin ilman ulkoista tietokantaa</li> <li>Konfiguroi Spring-palvelin k\u00e4ytt\u00e4m\u00e4\u00e4n ulkoista tietokantapalvelua</li> <li>Automatisoi build (valinnainen)</li> </ol>"},{"location":"reseptit/spring_rahti/#lisaohjeita","title":"Lis\u00e4ohjeita","text":"<ul> <li>Virheenj\u00e4ljitys</li> <li>HTTPS-konfigurointi</li> <li>Julkaisu yksityisest\u00e4 repositoriosta</li> </ul>"},{"location":"reseptit/spring_rahti/#liittyvia-ohjeita","title":"Liittyvi\u00e4 ohjeita","text":"<ul> <li>Julkaisu paikallisesta hakemistosta JKube OpenShift Maven pluginilla</li> </ul>"}]}